<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
    th:replace="~{layout :: layout(~{::title}, ~{::main})}">

<head>
    <title>R√©ceptions par BC</title>
</head>

<body>
    <main>
        <div class="container">
            <h1>üì¶ Suivi des R√©ceptions - BC <span th:text="${bonCommande.numero}">BC001</span></h1>

            <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
            <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

            <!-- Informations du BC -->
            <div class="card">
                <h2>üìÑ Bon de Commande</h2>
                <dl>
                    <dt>Num√©ro:</dt>
                    <dd>
                        <a th:href="@{/achats/bons-commande/{id}(id=${bonCommande.id})}"
                            th:text="${bonCommande.numero}">BC001</a>
                    </dd>

                    <dt>Fournisseur:</dt>
                    <dd th:text="${bonCommande.fournisseur?.raisonSociale}">Fournisseur</dd>

                    <dt>Date Commande:</dt>
                    <dd th:text="${#temporals.format(bonCommande.dateCommande, 'dd/MM/yyyy')}">01/01/2026</dd>

                    <dt>Statut:</dt>
                    <dd>
                        <span class="badge" th:text="${bonCommande.statut}">ENVOYEE</span>
                    </dd>
                </dl>
            </div>

            <!-- TODO.YML Ligne 16: Affichage du reliquat -->
            <div class="card" th:classappend="${reliquat > 0 ? 'alert-warning' : 'alert-success'}">
                <h2>üìä √âtat des R√©ceptions</h2>
                <div th:if="${reliquat > 0}">
                    <p class="text-warning">
                        ‚ö†Ô∏è <strong>Reliquat √† recevoir:</strong> <span th:text="${reliquat}">0</span> unit√©s
                    </p>
                    <a th:href="@{/achats/receptions/nouveau(bcId=${bonCommande.id})}" class="btn btn-primary">
                        üì¶ Cr√©er une nouvelle r√©ception
                    </a>
                </div>
                <div th:unless="${reliquat > 0}">
                    <p class="text-success">
                        ‚úÖ Toutes les marchandises ont √©t√© re√ßues
                    </p>
                </div>
            </div>

            <!-- Liste des r√©ceptions pour ce BC -->
            <div class="card">
                <h2>üìã Historique des R√©ceptions</h2>
                <table th:if="${!#lists.isEmpty(receptions)}">
                    <thead>
                        <tr>
                            <th>Num√©ro BR</th>
                            <th>Date R√©ception</th>
                            <th>Magasinier</th>
                            <th>BL Fournisseur</th>
                            <th>Statut</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="br : ${receptions}">
                            <td th:text="${br.numero}">BR001</td>
                            <td th:text="${#temporals.format(br.dateReception, 'dd/MM/yyyy')}">01/01/2026</td>
                            <td th:text="${br.magasinier?.nom}">Durand</td>
                            <td th:text="${br.numeroBlFournisseur}">BL-F-001</td>
                            <td>
                                <span th:class="${'badge badge-' + 
                                (br.statut == 'EN_COURS' ? 'info' :
                                 br.statut == 'PARTIELLE' ? 'warning' : 
                                 br.statut == 'COMPLETE' ? 'success' : 
                                 br.statut == 'AVEC_ECART' ? 'danger' : 'secondary')}"
                                    th:text="${br.statut}">PARTIELLE</span>
                            </td>
                            <td>
                                <a th:href="@{/achats/receptions/{id}(id=${br.id})}" class="btn btn-sm">
                                    <span th:if="${br.statut == 'EN_COURS'}">‚úèÔ∏è Continuer</span>
                                    <span th:unless="${br.statut == 'EN_COURS'}">üëÅÔ∏è Voir</span>
                                </a>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <p th:if="${#lists.isEmpty(receptions)}" class="text-center">
                    Aucune r√©ception enregistr√©e pour ce bon de commande.
                </p>
            </div>

            <!-- Actions -->
            <div class="actions">
                <a th:href="@{/achats/bons-commande/{id}(id=${bonCommande.id})}" class="btn">
                    ‚Üê Retour au Bon de Commande
                </a>
                <a th:href="@{/achats/receptions}" class="btn">
                    üìã Toutes les r√©ceptions
                </a>
            </div>
        </div>

        <style>
            .text-warning {
                color: #856404;
            }

            .text-success {
                color: #155724;
            }

            .text-center {
                text-align: center;
            }

            .alert-warning {
                background-color: #fff3cd;
                border: 1px solid #ffc107;
            }

            .alert-success {
                background-color: #d4edda;
                border: 1px solid #28a745;
            }
        </style>
    </main>
</body>

</html>