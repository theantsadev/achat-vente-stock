<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      th:replace="~{layout :: layout(~{::title}, ~{::main})}">
<head>
    <title>Nouvelle R√©ception</title>
</head>
<body>
<main>
    <div class="container">
        <h1>üì¶ Nouvelle R√©ception de Marchandises</h1>
        
        <div th:if="${warning}" class="alert alert-warning" th:text="${warning}"></div>
        
        <!-- TODO.YML Ligne 14: Informations du BC -->
        <div class="card">
            <h2>üìÑ Bon de Commande</h2>
            <dl>
                <dt>Num√©ro:</dt>
                <dd th:text="${bonCommande.numero}">BC001</dd>
                
                <dt>Fournisseur:</dt>
                <dd th:text="${bonCommande.fournisseur?.raisonSociale}">Fournisseur</dd>
                
                <dt>Date Commande:</dt>
                <dd th:text="${#temporals.format(bonCommande.dateCommande, 'dd/MM/yyyy')}">01/01/2026</dd>
                
                <dt>Montant TTC:</dt>
                <dd th:text="${#numbers.formatDecimal(bonCommande.montantTotalTtc, 1, 2)} + ' ‚Ç¨'">1000.00 ‚Ç¨</dd>
            </dl>
        </div>
        
        <!-- TODO.YML Ligne 16: Afficher reliquat si r√©ceptions pr√©c√©dentes -->
        <div class="card" th:if="${reliquat != null and reliquat > 0}">
            <h2>‚ö†Ô∏è Reliquat √† recevoir</h2>
            <p class="alert alert-info">
                Il reste <strong th:text="${reliquat}">0</strong> unit√©s √† recevoir de commandes pr√©c√©dentes.
            </p>
        </div>
        
        <!-- TODO.YML Ligne 14: Aper√ßu des lignes √† r√©ceptionner -->
        <div class="card" th:if="${lignesBC != null and !lignesBC.isEmpty()}">
            <h2>üìã Articles √† r√©ceptionner</h2>
            <table>
                <thead>
                    <tr>
                        <th>Code</th>
                        <th>D√©signation</th>
                        <th>Qt√© Command√©e</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="ligne : ${lignesBC}">
                        <td th:text="${ligne.article?.code}">ART001</td>
                        <td th:text="${ligne.article?.designation}">Article</td>
                        <td th:text="${ligne.quantite}">100</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Formulaire de cr√©ation -->
        <div class="card">
            <h2>üìù Informations du Bon de Livraison Fournisseur</h2>
            <form th:action="@{/achats/receptions}" method="post">
                <input type="hidden" name="bcId" th:value="${bonCommande.id}" />
                
                <div class="form-group">
                    <label for="numeroBlFournisseur">N¬∞ BL Fournisseur: <span class="required">*</span></label>
                    <input type="text" id="numeroBlFournisseur" name="numeroBlFournisseur" required 
                           placeholder="Ex: BL-2026-001" />
                </div>
                
                <div class="form-group">
                    <label for="dateBlFournisseur">Date BL Fournisseur: <span class="required">*</span></label>
                    <input type="date" id="dateBlFournisseur" name="dateBlFournisseur" required 
                           th:value="${#temporals.format(#temporals.createNow(), 'yyyy-MM-dd')}" />
                </div>
                
                <div class="actions">
                    <button type="submit" class="btn btn-primary">üì¶ Cr√©er R√©ception et Commencer le Contr√¥le</button>
                    <a th:href="@{/achats/bons-commande/{id}(id=${bonCommande.id})}" class="btn">Annuler</a>
                </div>
            </form>
        </div>
    </div>
</main>
</body>
</html>
