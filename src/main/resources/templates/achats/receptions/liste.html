<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      th:replace="~{layout :: layout(~{::title}, ~{::main})}">

<head>
    <title>R√©ceptions</title>
</head>

<body>
    <main>
        <div class="container">
            <h1>üì¶ R√©ceptions de Marchandises</h1>

            <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
            <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>
            <div th:if="${warning}" class="alert alert-warning" th:text="${warning}"></div>

            <!-- Filtres -->
            <div class="card">
                <form method="get" class="form-inline">
                    <label for="statutFiltre">Filtrer par statut:</label>
                    <select id="statutFiltre" onchange="filtrerParStatut(this.value)">
                        <option value="">Tous</option>
                        <option value="EN_COURS">En cours</option>
                        <option value="PARTIELLE">Partielles</option>
                        <option value="COMPLETE">Compl√®tes</option>
                        <option value="AVEC_ECART">Avec √©carts</option>
                    </select>
                </form>
            </div>

            <!-- TODO.YML Ligne 14-16: Liste des r√©ceptions -->
            <table id="tableReceptions">
                <thead>
                    <tr>
                        <th>Num√©ro</th>
                        <th>Bon Commande</th>
                        <th>Fournisseur</th>
                        <th>Magasinier</th>
                        <th>Date R√©ception</th>
                        <th>BL Fournisseur</th>
                        <th>Statut</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="br : ${receptions}" th:data-statut="${br.statut}">
                        <td th:text="${br.numero}">BR001</td>
                        <td>
                            <a th:href="@{/achats/bons-commande/{id}(id=${br.bonCommande?.id})}"
                               th:text="${br.bonCommande?.numero}">BC001</a>
                        </td>
                        <td th:text="${br.bonCommande?.fournisseur?.raisonSociale}">Fournisseur</td>
                        <td th:text="${br.magasinier?.nom}">Durand</td>
                        <td th:text="${#temporals.format(br.dateReception, 'dd/MM/yyyy')}">01/01/2026</td>
                        <td th:text="${br.numeroBlFournisseur}">BL-F-001</td>
                        <td>
                            <span th:class="${'badge badge-' + 
                            (br.statut == 'EN_COURS' ? 'info' :
                             br.statut == 'PARTIELLE' ? 'warning' : 
                             br.statut == 'COMPLETE' ? 'success' : 
                             br.statut == 'AVEC_ECART' ? 'danger' : 'secondary')}"
                                th:text="${br.statut}">EN_COURS</span>
                        </td>
                        <td>
                            <a th:href="@{/achats/receptions/{id}(id=${br.id})}" class="btn btn-sm">
                                <span th:if="${br.statut == 'EN_COURS'}">‚úèÔ∏è Continuer</span>
                                <span th:unless="${br.statut == 'EN_COURS'}">üëÅÔ∏è Voir</span>
                            </a>
                        </td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(receptions)}">
                        <td colspan="8" class="text-center">Aucune r√©ception enregistr√©e</td>
                    </tr>
                </tbody>
            </table>
            
            <!-- L√©gende des statuts -->
            <div class="card">
                <h3>L√©gende des statuts</h3>
                <ul class="legend">
                    <li><span class="badge badge-info">EN_COURS</span> R√©ception en cours de saisie</li>
                    <li><span class="badge badge-success">COMPLETE</span> Toutes les quantit√©s command√©es ont √©t√© re√ßues et conformes</li>
                    <li><span class="badge badge-warning">PARTIELLE</span> Quantit√©s re√ßues inf√©rieures aux quantit√©s command√©es (reliquat)</li>
                    <li><span class="badge badge-danger">AVEC_ECART</span> Des non-conformit√©s ont √©t√© d√©tect√©es</li>
                </ul>
            </div>
        </div>
        
        <script>
            function filtrerParStatut(statut) {
                const rows = document.querySelectorAll('#tableReceptions tbody tr');
                rows.forEach(row => {
                    if (!statut || row.dataset.statut === statut) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                });
            }
        </script>
        
        <style>
            .legend { list-style: none; padding: 0; }
            .legend li { margin: 0.5rem 0; }
            .form-inline { display: flex; gap: 1rem; align-items: center; }
            .text-center { text-align: center; }
        </style>
    </main>
</body>

</html>