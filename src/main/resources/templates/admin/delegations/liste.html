<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: layout(~{::title}, ~{::main})}">
<head>
    <title>D√©l√©gations - Administration</title>
</head>
<body>
<main>
    <h2>üîÑ Gestion des D√©l√©gations</h2>
    
    <!-- Messages flash -->
    <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
    <div th:if="${error}" class="alert alert-error" th:text="${error}"></div>
    
    <!-- Bouton nouvelle d√©l√©gation -->
    <div style="margin-bottom: 1rem;">
        <a th:href="@{/admin/delegations/nouvelle}" class="btn btn-success">‚ûï Nouvelle d√©l√©gation</a>
    </div>
    
    <!-- Mes d√©l√©gations donn√©es -->
    <h3 style="margin-top: 2rem; margin-bottom: 1rem; color: #2c3e50;">üì§ D√©l√©gations que j'ai donn√©es</h3>
    <table>
        <thead>
            <tr>
                <th>D√©l√©gataire</th>
                <th>R√¥le d√©l√©gu√©</th>
                <th>Date d√©but</th>
                <th>Date fin</th>
                <th>Justification</th>
                <th>Statut</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="d : ${delegationsDonnees}">
                <td th:text="${d.delegataire.prenom + ' ' + d.delegataire.nom + ' (' + d.delegataire.login + ')'}"></td>
                <td><strong th:text="${d.role.libelle}"></strong></td>
                <td th:text="${#temporals.format(d.dateDebut, 'dd/MM/yyyy')}"></td>
                <td th:text="${d.dateFin != null ? #temporals.format(d.dateFin, 'dd/MM/yyyy') : 'Ind√©finie'}"></td>
                <td th:text="${d.justification ?: '-'}"></td>
                <td>
                    <span th:if="${d.statut == 'ACTIVE'}" style="color: #27ae60; font-weight: bold;">‚úì Active</span>
                    <span th:if="${d.statut == 'ANNULEE'}" style="color: #e74c3c; font-weight: bold;">‚úó Annul√©e</span>
                    <span th:if="${d.statut == 'EXPIREE'}" style="color: #95a5a6; font-weight: bold;">‚äò Expir√©e</span>
                </td>
                <td>
                    <form th:if="${d.statut == 'ACTIVE'}" 
                          th:action="@{/admin/delegations/{id}/annuler(id=${d.id})}" 
                          method="post" style="display: inline;">
                        <button type="submit" class="btn btn-danger" style="padding: 0.25rem 0.5rem;"
                                onclick="return confirm('Annuler cette d√©l√©gation ?')">üóë Annuler</button>
                    </form>
                </td>
            </tr>
            <tr th:if="${#lists.isEmpty(delegationsDonnees)}">
                <td colspan="7" style="text-align: center; padding: 1rem; color: #7f8c8d;">
                    Vous n'avez donn√© aucune d√©l√©gation
                </td>
            </tr>
        </tbody>
    </table>
    
    <!-- D√©l√©gations re√ßues -->
    <h3 style="margin-top: 2rem; margin-bottom: 1rem; color: #2c3e50;">üì• D√©l√©gations que j'ai re√ßues</h3>
    <table>
        <thead>
            <tr>
                <th>D√©l√©gant</th>
                <th>R√¥le d√©l√©gu√©</th>
                <th>Date d√©but</th>
                <th>Date fin</th>
                <th>Justification</th>
                <th>Statut</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="d : ${delegationsRecues}">
                <td th:text="${d.delegant.prenom + ' ' + d.delegant.nom + ' (' + d.delegant.login + ')'}"></td>
                <td><strong th:text="${d.role.libelle}"></strong></td>
                <td th:text="${#temporals.format(d.dateDebut, 'dd/MM/yyyy')}"></td>
                <td th:text="${d.dateFin != null ? #temporals.format(d.dateFin, 'dd/MM/yyyy') : 'Ind√©finie'}"></td>
                <td th:text="${d.justification ?: '-'}"></td>
                <td>
                    <span th:if="${d.statut == 'ACTIVE'}" style="color: #27ae60; font-weight: bold;">‚úì Active</span>
                    <span th:if="${d.statut == 'ANNULEE'}" style="color: #e74c3c; font-weight: bold;">‚úó Annul√©e</span>
                    <span th:if="${d.statut == 'EXPIREE'}" style="color: #95a5a6; font-weight: bold;">‚äò Expir√©e</span>
                </td>
            </tr>
            <tr th:if="${#lists.isEmpty(delegationsRecues)}">
                <td colspan="6" style="text-align: center; padding: 1rem; color: #7f8c8d;">
                    Vous n'avez re√ßu aucune d√©l√©gation
                </td>
            </tr>
        </tbody>
    </table>
    
    <!-- Toutes les d√©l√©gations (admin seulement) -->
    <div th:if="${toutesDelegations != null}">
        <h3 style="margin-top: 2rem; margin-bottom: 1rem; color: #2c3e50;">üìã Toutes les d√©l√©gations (Admin)</h3>
        <table>
            <thead>
                <tr>
                    <th>D√©l√©gant</th>
                    <th>D√©l√©gataire</th>
                    <th>R√¥le</th>
                    <th>P√©riode</th>
                    <th>Statut</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="d : ${toutesDelegations}">
                    <td th:text="${d.delegant.login}"></td>
                    <td th:text="${d.delegataire.login}"></td>
                    <td th:text="${d.role.libelle}"></td>
                    <td th:text="${#temporals.format(d.dateDebut, 'dd/MM/yyyy') + ' ‚Üí ' + (d.dateFin != null ? #temporals.format(d.dateFin, 'dd/MM/yyyy') : '‚àû')}"></td>
                    <td>
                        <span th:if="${d.statut == 'ACTIVE'}" style="color: #27ae60;">‚úì</span>
                        <span th:if="${d.statut == 'ANNULEE'}" style="color: #e74c3c;">‚úó</span>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</main>
</body>
</html>
